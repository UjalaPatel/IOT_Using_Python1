import sqlite3
import paho.mqtt.client as mqtt
import time
import datetime

db = sqlite3.connect("externaldb")
cur = db.cursor()

cur.execute("""create table if not exists tblpublish(publisherID integer primary key autoincrement,message text,datetime current_timestamp)""")

def on_connect(client,userdate,flag,rs):
    print(f"connect to the result {rs}")
    
client = mqtt.Client()
client.on_connect = on_connect
client.connect("broker.hivemq.com",1883,60)
str = "Welcome to VNSGU rollno: 5"

cur.execute("select * from tblpublish order by publisherID desc limit 3")
sortdata = cur.fetchall()

for raw in sortdata:
    print(raw)
    time.sleep(1)

#while True:
for i in range(3):  
    client.publish(topic="badsuratSaurabh",payload=str+f"{i}",qos=0,retain=False)
    sql = """insert into tblpublish(message,datetime) values(?,?)"""
    data = (str,datetime.datetime.now())
    cur.execute(sql,data)
    db.commit()
    print("sent data to Saurabh")
    time.sleep(1)
client.loop_forever()




















































































































































































































































































































































































































